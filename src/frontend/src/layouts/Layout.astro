---
import Navbar from '../components/navbar/Navbar.astro'
import Footer from '../components/Footer.astro'
import '../styles/global.css'

interface Props {
  title: string
}

const { title } = Astro.props
---

<!doctype html>
<html lang='en'>
  <head>
    <meta charset='UTF-8' />
    <meta name='description' content='Astro description' />
    <meta name='viewport' content='width=device-width' />

    <!-- Favicons -->
    <link rel='icon' type='image/svg+xml' href='/favicon.svg' />
    <link rel='icon' type='image/png' sizes='96x96' href='/favicon-96x96.png' />
    <link rel='icon' type='image/x-icon' href='/favicon.ico' />

    <!-- Apple Touch Icon -->
    <link rel='apple-touch-icon' href='/apple-touch-icon.png' />

    <!-- Web App Manifest -->
    <link rel='manifest' href='/site.webmanifest' />
    <meta name='theme-color' content='#fffbf9' />
    <meta
      name='theme-color'
      media='(prefers-color-scheme: dark)'
      content='#1c1413'
    />
    <meta name='msapplication-TileColor' content='#b12424' />

    <meta name='generator' content={Astro.generator} />
    <title>{title}</title>
    <link rel='preconnect' href='https://fonts.googleapis.com' />
    <link rel='preconnect' href='https://fonts.gstatic.com' crossorigin />
    <link
      href='https://fonts.googleapis.com/css2?family=Mina:wght@400;700&display=swap'
      rel='stylesheet'
    />
    <link
      href='https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap'
      rel='stylesheet'
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
      integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV"
      crossorigin="anonymous"
    />
    <script is:inline>
      // Set theme immediately to prevent flash - runs on every navigation
      // Guard against SSR environments where window/document may not exist
      if (typeof window !== 'undefined' && typeof document !== 'undefined') {
        const storedTheme =
          typeof localStorage !== 'undefined'
            ? localStorage.getItem('theme')
            : null
        let shouldBeDark = false

        if (storedTheme === 'dark') {
          shouldBeDark = true
        } else if (storedTheme === 'light') {
          shouldBeDark = false
        } else {
          // 'system' or no preference - check system preference
          if (window.matchMedia) {
            shouldBeDark = window.matchMedia(
              '(prefers-color-scheme: dark)'
            ).matches
          }
        }

        if (shouldBeDark) {
          document.documentElement.classList.add('dark')
        } else {
          document.documentElement.classList.remove('dark')
        }
      }
    </script>
  </head>
  <body>
    <Navbar />
    <slot />
    <Footer />
    <style is:global>
      /* Material Design 3 - Light Theme */
      :root {
        --font-family: 'Noto Sans', sans-serif;
        --font-family-heading: 'Mina', sans-serif;

        /* Primary Colors */
        --md-primary: #b12424;
        --md-on-primary: #ffffff;
        --md-primary-container: #ffdad6;
        --md-on-primary-container: #410002;

        /* Secondary Colors */
        --md-secondary: #775652;
        --md-on-secondary: #ffffff;
        --md-secondary-container: #ffdad6;
        --md-on-secondary-container: #2c1512;

        /* Tertiary Colors */
        --md-tertiary: #6b5d2f;
        --md-on-tertiary: #ffffff;
        --md-tertiary-container: #f4e0a6;
        --md-on-tertiary-container: #231b00;

        /* Error Colors */
        --md-error: #ba1a1a;
        --md-on-error: #ffffff;
        --md-error-container: #ffdad6;
        --md-on-error-container: #410002;

        /* Surface Colors */
        --md-surface: #fffbf9;
        --md-on-surface: #201a19;
        --md-surface-variant: #f5ddd9;
        --md-on-surface-variant: #534341;

        /* Outline Colors */
        --md-outline: #857370;
        --md-outline-variant: #d8c2be;

        /* Background Colors */
        --md-background: #fffbf9;
        --md-on-background: #201a19;

        /* Shadow */
        --md-shadow: rgba(0, 0, 0, 0.2);

        /* Legacy compatibility */
        --bg-primary: var(--md-surface);
        --bg-secondary: var(--md-surface-variant);
        --bg-tertiary: var(--md-primary-container);
        --text-primary: var(--md-on-surface);
        --text-secondary: var(--md-on-surface-variant);
        --text-tertiary: var(--md-outline);
        --border-color: var(--md-outline-variant);
        --border-color-hover: var(--md-outline);
        --shadow: var(--md-shadow);
        --accent-color: var(--md-primary);
        --accent-hover: color-mix(in srgb, var(--md-primary) 85%, black);
      }

      /* Material Design 3 - Dark Theme */
      html.dark {
        /* Primary Colors */
        --md-primary: #9067c4; /* Slightly more saturated, vibrant purple */
        --md-on-primary: #381e72;
        --md-primary-container: #574288; /* More distinct container - deeper, slightly desaturated */
        --md-on-primary-container: #eaddff;

        /* Secondary Colors */
        --md-secondary: #6200ee; /* A more vibrant, distinct secondary – leaning towards a deep indigo */
        --md-on-secondary: #332d41;
        --md-secondary-container: #3700b3; /* A more defined secondary container – darker, more saturated */
        --md-on-secondary-container: #e8def8;

        /* Tertiary Colors -  Using the primary and secondary as a base for harmony */
        --md-tertiary: #81d4fa; /* A light teal-ish tone that complements the purples - MD3 often uses analogous colors */
        --md-on-tertiary: #000000; /* Dark text for contrast */
        --md-tertiary-container: #64b5f6; /*  Slightly darker teal */
        --md-on-tertiary-container: #d0bcff; /* Matches primary container for consistency */

        /* Error Colors */
        --md-error: #b00020; /* A standard red-orange for error states */
        --md-on-error: #ffffff; /* White text for contrast */
        --md-error-container: #ff1744; /* Red-orange container */
        --md-on-error-container: #ffdeba; /* Lighter red-orange for on-error-container */

        /* Surface Colors */
        --md-surface: #1d1b21; /* Slightly darker than the background for subtle elevation */
        --md-on-surface: #ede0dd;
        --md-surface-variant: #333135; /* Darker variant for more contrast */
        --md-on-surface-variant: #d8c2be;

        /* Outline Colors */
        --md-outline: rgba(255, 255, 255, 0.15); /* Even more subtle outline */
        --md-outline-variant: rgba(0, 0, 0, 0.08); /* Very subtle */

        /* Background Colors */
        --md-background: #1c1b1f;
        --md-on-background: #ede0dd;

        /* Shadow */
        --md-shadow: rgba(0, 0, 0, 0.4);

        /* Legacy compatibility */
        --bg-primary: var(--md-surface);
        --bg-secondary: var(--md-surface-variant);
        --bg-tertiary: var(--md-primary-container);
        --text-primary: var(--md-on-surface);
        --text-secondary: var(--md-on-surface-variant);
        --text-tertiary: var(--md-outline);
        --border-color: var(--md-outline-variant);
        --border-color-hover: var(--md-outline);
        --shadow: var(--md-shadow);
        --accent-color: var(--md-primary);
        --accent-hover: color-mix(in srgb, var(--md-primary) 85%, white);
      }
      body {
        margin: 0;
        width: 100%;
        scroll-behavior: smooth;
        overflow-x: hidden;
        color: var(--text-primary);
        background-color: var(--md-background);
        font-family: var(--font-family);
        font-optical-sizing: auto;
        transition:
          background-color 0.3s ease,
          color 0.3s ease;
      }

      /* Headings use Mina */
      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        font-family: var(--font-family-heading);
      }

      /* Navbar and Footer use Mina */
      nav,
      nav *,
      footer,
      footer * {
        font-family: var(--font-family-heading);
      }

      code {
        font-family:
          Menlo,
          Monaco,
          Lucida Console,
          Liberation Mono,
          DejaVu Sans Mono,
          Bitstream Vera Sans Mono,
          Courier New,
          monospace;
      }

      /* Theme-aware component styles */
      html.dark nav {
        background-color: var(--bg-secondary);
        border-bottom-color: var(--border-color);
      }

      html.dark .nav-link {
        color: var(--text-secondary);
      }

      html.dark .nav-link:hover {
        color: var(--accent-color);
      }

      html.dark .nav-link.active {
        color: var(--accent-color);
      }

      html.dark .logo-link {
        color: var(--text-primary);
      }

      html.dark .logo-link:hover {
        color: var(--accent-color);
      }

      html.dark .mobile-menu {
        background: var(--bg-secondary);
      }

      html.dark .mobile-menu .nav-link {
        color: var(--text-primary);
      }

      html.dark .mobile-menu .nav-link:hover {
        background-color: var(--bg-tertiary);
      }

      html.dark .mobile-menu .nav-link.active {
        background-color: var(--bg-tertiary);
      }

      html.dark .hamburger span {
        background: var(--text-primary);
      }

      html.dark footer {
        background-color: var(--bg-tertiary);
        color: var(--text-primary);
      }

      html.dark footer a {
        color: var(--text-secondary);
      }

      html.dark footer a:hover {
        color: var(--text-primary);
      }
    </style>
  </body>
</html>
